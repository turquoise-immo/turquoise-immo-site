<!doctype html><html lang="fr"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><title>Admin Turquoise.Immo</title><link rel="stylesheet" href="style.css"></head><body><header class="site-header"><div class="container header-inner"><div class="brand"><a href="/"><img class="logo" src="https://images.unsplash.com/photo-1560185127-6d6d7f0c1949?q=80&w=200"> Turquoise.Immo - Admin</a></div></div></header><div style="max-width:1100px;margin:2rem auto;padding:1rem"><h1>Administration</h1><div id="loginBox"><form id="loginForm"><label>Identifiant<input id="loginUser" required></label><label>Mot de passe<input id="loginPass" type="password" required></label><button class="btn-primary" type="submit">Se connecter</button></form><div id="loginMsg"></div></div><div id="adminPanel" style="display:none"><button id="btnLogout" class="btn-secondary">Se déconnecter</button><h2>Annonces</h2><div id="listingsList"></div><h3>Créer / Modifier</h3><form id="editForm"><input id="editId" type="hidden"><label>Titre<input id="editTitle"></label><label>Ville<input id="editCity"></label><label>Prix<input id="editPrice" type="number"></label><label>Surface<input id="editSurface" type="number"></label><label>Lat<input id="editLat" type="number" step="any"></label><label>Lng<input id="editLng" type="number" step="any"></label><label>Images (virgules)<input id="editImages"></label><label>Description<textarea id="editDesc"></textarea></label><div style="display:flex;gap:.5rem"><button id="saveBtn" class="btn-primary" type="button">Enregistrer</button><button id="newBtn" class="btn-secondary" type="button">Nouvelle</button></div></form></div></div><script>const API='';function el(q){return document.querySelector(q)} async function checkSession(){ try{ const res=await fetch('/api/admin/session'); if(res.ok){ const j=await res.json(); if(j.auth) showAdmin(); else showLogin(); }else showLogin(); }catch(e){ showLogin(); } } function showLogin(){ el('#loginBox').style.display='block'; el('#adminPanel').style.display='none'; } function showAdmin(){ el('#loginBox').style.display='none'; el('#adminPanel').style.display='block'; loadListings(); } checkSession(); document.getElementById('loginForm').addEventListener('submit', async (e)=>{ e.preventDefault(); const payload={ user:el('#loginUser').value.trim(), pass:el('#loginPass').value }; const res = await fetch('/api/login',{ method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(payload) }); if(res.ok){ showAdmin(); } else { el('#loginMsg').textContent='Identifiants incorrects'; } }); document.getElementById('btnLogout').addEventListener('click', async ()=>{ await fetch('/api/logout',{method:'POST'}); showLogin(); }); async function loadListings(){ const res=await fetch('/api/listings'); const data=await res.json(); const c=el('#listingsList'); c.innerHTML=''; data.forEach(it=>{ const row=document.createElement('div'); row.style.padding='.5rem'; row.innerHTML=`<strong>${it.title}</strong> <small style="color:var(--muted)">${it.id}</small> <button onclick="edit('${it.id}')" class="btn-secondary">Edit</button> <button onclick="del('${it.id}')" class="btn-secondary">Suppr</button>`; c.appendChild(row); }); } window.edit = async function(id){ const res=await fetch('/api/listings/'+id); if(!res.ok) return alert('Erreur'); const it=await res.json(); el('#editId').value=it.id; el('#editTitle').value=it.title; el('#editCity').value=it.city; el('#editPrice').value=it.price; el('#editSurface').value=it.surface; el('#editLat').value=it.lat||''; el('#editLng').value=it.lng||''; el('#editImages').value=(it.images||[]).join(','); el('#editDesc').value=it.description||''; } document.getElementById('newBtn').addEventListener('click', ()=>{ ['editId','editTitle','editCity','editPrice','editSurface','editLat','editLng','editImages','editDesc'].forEach(id=>el('#'+id).value=''); }); document.getElementById('saveBtn').addEventListener('click', async ()=>{ const payload={ id:el('#editId').value||undefined, title:el('#editTitle').value, city:el('#editCity').value, price:parseFloat(el('#editPrice').value)||0, surface:parseFloat(el('#editSurface').value)||0, lat:parseFloat(el('#editLat').value)||undefined, lng:parseFloat(el('#editLng').value)||undefined, images: el('#editImages').value?el('#editImages').value.split(',').map(s=>s.trim()):[], description:el('#editDesc').value }; const method = payload.id?'PUT':'POST'; const url = payload.id?'/api/listings/'+payload.id:'/api/listings'; const res = await fetch(url,{ method, headers:{'Content-Type':'application/json'}, body:JSON.stringify(payload)}); if(res.ok){ alert('Enregistré'); loadListings(); } else alert('Erreur'); }); window.del = async function(id){ if(!confirm('Supprimer '+id+' ?')) return; const res = await fetch('/api/listings/'+id,{ method:'DELETE' }); if(res.ok) loadListings(); else alert('Erreur'); };</script></body></html>